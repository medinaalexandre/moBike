{% load staticfiles %}
{% load material_form %}
{% load tempo_atual %}
<!DOCTYPE html>
<html lang="en">
<head>

        <title>moBike - modo ciclista</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta charset="UTF-8">
        <!-- css files -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" href="{% static 'css/home.css' %}">
        {% include 'material/includes/material_css.html' %}
        <script src="{% static 'material/js/jquery.js' %}"></script>
        {% include 'material/includes/material_js.html' %}
        <!-- bootstrap -->
</head>
<body>

        <div class="container-fluid">
         <div class="row">
          <div class="col-md-2 bg-light">
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
              <a class="nav-link active" href="#" role="tab" aria-controls="v-pills-home" aria-selected="true">Início</a>
              <a class="nav-link" href="{% url 'ciclistas' %}" role="tab" aria-controls="v-pills-ciclistas" aria-selected="false">Ciclistas</a>
              <a class="nav-link" href="{% url 'entregas' %}"  role="tab" aria-controls="v-pills-entregas" aria-selected="false">Entregas</a>
              <a class="nav-link" href="{% url 'modociclista' %}"  role="tab" aria-controls="v-pills-entregas" aria-selected="false">Modo Ciclista</a>
              <a class="nav-link" href="#" role="tab" aria-controls="v-pills-login" aria-selected="false">Logout</a>
                <br>
                <b>Hora: {% tempo_atual %}</b>
            </div>
          </div>
             <div class="col-md-10">
                 <div class="row">
                     <div class="col-md-12"><center><h3>Olá, {{ ciclista }}!</h3></center></div>
                 </div>
                 <div class="row">
                     <div class="col-md-2">
                         <form>
                             <input type = "button" onclick = "getLocationUpdate();" value = "Compartilhar Localização"/>
                         </form>
                     </div>
                     <div class="col-md-4">
                            <h4>Entrega atual</h4>
                            {% if entregaatual != None %}
                             <p>Endereço de Coleta:{{ entregaatual.end_coleta }}</p>
                             <p>Endereço de Entrega: {{ entregaatual.end_entrega }}</p>
                             <p>Horário do pedido: {{ entregaatual.data }}</p>
                             <p>Horário </p>
                             <p>Tempo estimado para entrega:</p>
                            {% else %}
                                <h3>Sem entrega</h3>
                            {% endif %}



                     </div>
                     <div class="col-md-4">
                         <h4>Histórico de entregas</h4>
                         <table>
                            <tr><th>Data</th>
                                <th>Coleta</th>
                                <th>Entrega</th></tr>
                            {% for e in entregas %}
                                <tr><td>{{e.data|date:"d/m Y"}}</td>
                                    <td>{{e.end_coleta}}</td>
                                    <td>{{e.end_entrega}}</td>
                                </tr>
                            {% endfor %}
                         </table>
                     </div>

                 </div>
             </div>
         </div>
        </div>

    <script type = "text/javascript">
         var watchID;
         var geoLoc;

         function showLocation(position) {
            console.log(position);
             $.ajax({
                url: '{%url 'salvaXY' %}',
                data: {
                  'latitude': position.coords.latitude,
                  'longitude': position.coords.longitude
                },
                dataType: 'json',
                success: function (data) {
                  if (data.is_taken) {
                    console.log("O usuário não saiu do lugar");
                  }
                }
              });
         }

         function errorHandler(err) {
            if(err.code == 1) {
               alert("Error: Access is denied!");
            } else if( err.code == 2) {
               alert("Error: Position is unavailable!");
            }
         }

         function getLocationUpdate(){

            if(navigator.geolocation){

               // timeout at 60000 milliseconds (60 seconds)
               var options = {timeout:60000, enableHighAccuracy: true};
               geoLoc = navigator.geolocation;
               watchID = geoLoc.watchPosition(showLocation, errorHandler, options);
            } else {
               alert("Sorry, browser does not support geolocation!");
            }
         }
      </script>
</body>
</html>